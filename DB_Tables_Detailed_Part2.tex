\documentclass[11pt,a4paper]{article}

% Packages
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{xcolor}
\usepackage{titlesec}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{tcolorbox}
\usepackage{longtable}
\usepackage{array}
\usepackage{booktabs}
\usepackage{tikz}

% Page geometry
\geometry{
    left=2cm,
    right=2cm,
    top=2.5cm,
    bottom=2.5cm
}

% Color definitions
\definecolor{primaryBlue}{RGB}{0, 102, 204}
\definecolor{accentOrange}{RGB}{255, 127, 0}
\definecolor{darkGray}{RGB}{51, 51, 51}
\definecolor{lightGray}{RGB}{245, 245, 245}
\definecolor{tableHeader}{RGB}{25, 118, 210}

% Title formatting
\titleformat{\section}
  {\color{primaryBlue}\Large\bfseries}
  {\thesection}{1em}{}[\titlerule]

\titleformat{\subsection}
  {\color{accentOrange}\large\bfseries}
  {\thesubsection}{1em}{}

% Hyperref setup
\hypersetup{
    colorlinks=true,
    linkcolor=primaryBlue,
    filecolor=accentOrange,
    urlcolor=primaryBlue,
    pdftitle={SavoyConnect Database Tables - Part 2},
    pdfauthor={Rifaf Rahman}
}

% Header and footer
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\color{primaryBlue}\textbf{SavoyConnect Database - Part 2}}
\fancyhead[R]{\color{darkGray}\thepage}
\fancyfoot[C]{\color{darkGray}\small Tables 11-20 | Prepared by Rifaf Rahman | November 2025}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}

% Custom boxes
\newtcolorbox{tablebox}[1]{
  colback=lightGray,
  colframe=primaryBlue,
  fonttitle=\bfseries\large,
  title=#1,
  arc=2mm,
  boxrule=1mm
}

\begin{document}

% Title page
\begin{titlepage}
    \begin{tikzpicture}[remember picture,overlay]
        \fill[primaryBlue] (current page.north west) rectangle ([yshift=-8cm]current page.north east);
    \end{tikzpicture}
    
    \vspace*{2cm}
    
    {\color{white}\Huge\bfseries SavoyConnect}\\[0.5cm]
    {\color{white}\LARGE Database Schema - Part 2}\\[0.3cm]
    {\color{white}\Large Detailed Table Properties}\\[2cm]
    
    \vspace{3cm}
    
    \begin{tcolorbox}[colback=white,colframe=accentOrange,width=0.8\textwidth,arc=3mm,boxrule=1mm]
        \begin{tabular}{ll}
            \textbf{\color{primaryBlue}Prepared by:} & Rifaf Rahman \\[0.3cm]
            \textbf{\color{primaryBlue}Document:} & Part 2 of 8 \\[0.3cm]
            \textbf{\color{primaryBlue}Tables:} & 11-20 (MVP Phase) \\[0.3cm]
            \textbf{\color{primaryBlue}Date:} & November 9, 2025 \\
        \end{tabular}
    \end{tcolorbox}
    
    \vfill
    
    {\large\color{darkGray} Order Management, Location \& Inventory, Delivery Tracking}
    
\end{titlepage}

\tableofcontents
\newpage

\section{Product Catalog Tables (Continued)}

\subsection{Table 11: product\_images}

\begin{tablebox}{product\_images - Product Image Management}
\textbf{Purpose:} Manages multiple images per product with types and ordering.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} product\_id (references products.id)\\
\textbf{Indexes:} product\_id, is\_primary, sort\_order
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
product\_id & BIGINT & FOREIGN KEY, NOT NULL, References products(id) ON DELETE CASCADE \\
\hline
image\_url & VARCHAR(500) & NOT NULL, Full URL to image stored in cloud storage (S3/CDN) \\
\hline
thumbnail\_url & VARCHAR(500) & NULL, URL to thumbnail version for list views \\
\hline
image\_type & ENUM & NOT NULL, Values: 'primary', 'gallery', 'lifestyle', '360\_view', 'packaging' \\
\hline
alt\_text & VARCHAR(255) & NULL, Alternative text for accessibility and SEO \\
\hline
is\_primary & BOOLEAN & NOT NULL, DEFAULT FALSE, Primary product image flag \\
\hline
sort\_order & INT & NOT NULL, DEFAULT 0, Display order in gallery \\
\hline
width\_px & INT & NULL, Original image width in pixels \\
\hline
height\_px & INT & NULL, Original image height in pixels \\
\hline
file\_size\_kb & INT & NULL, Image file size in kilobytes \\
\hline
format & VARCHAR(10) & NULL, Image format: 'jpg', 'png', 'webp', 'avif' \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{product\_images table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: products (product\_id)
\end{itemize}

\textbf{Image Type Usage:}
\begin{itemize}
    \item \textbf{primary:} Main product card image
    \item \textbf{gallery:} Additional product photos
    \item \textbf{lifestyle:} Product in use/context photos
    \item \textbf{360\_view:} Images for 360-degree product viewer
    \item \textbf{packaging:} Packaging and box images
\end{itemize}

\newpage

\section{Order Management Tables}

\subsection{Table 12: orders}

\begin{tablebox}{orders - Customer Orders}
\textbf{Purpose:} Main order records with totals, status, and delivery information.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} user\_id, delivery\_address\_id\\
\textbf{Indexes:} user\_id, order\_number (unique), status, created\_at
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
order\_number & VARCHAR(50) & UNIQUE, NOT NULL, Human-readable order ID (e.g., "ORD-20251109-0001") \\
\hline
user\_id & BIGINT & FOREIGN KEY, NOT NULL, References users(id) \\
\hline
delivery\_address\_id & BIGINT & FOREIGN KEY, NOT NULL, References user\_addresses(id) \\
\hline
status & ENUM & NOT NULL, DEFAULT 'pending', Values: 'pending', 'confirmed', 'preparing', 'ready', 'out\_for\_delivery', 'delivered', 'cancelled', 'refunded' \\
\hline
subtotal & DECIMAL(10, 2) & NOT NULL, Sum of all order items before fees and discounts \\
\hline
delivery\_fee & DECIMAL(10, 2) & NOT NULL, DEFAULT 0.00, Delivery charge \\
\hline
discount\_amount & DECIMAL(10, 2) & NOT NULL, DEFAULT 0.00, Total discount applied \\
\hline
tax\_amount & DECIMAL(10, 2) & NOT NULL, DEFAULT 0.00, Tax/VAT amount \\
\hline
total\_amount & DECIMAL(10, 2) & NOT NULL, Final order total (subtotal + fees - discounts + tax) \\
\hline
currency & VARCHAR(3) & NOT NULL, DEFAULT 'BDT', ISO 4217 currency code \\
\hline
payment\_status & ENUM & NOT NULL, DEFAULT 'pending', Values: 'pending', 'paid', 'failed', 'refunded', 'partially\_refunded' \\
\hline
payment\_method & VARCHAR(50) & NULL, Payment method used: 'card', 'mobile\_wallet', 'cash\_on\_delivery' \\
\hline
order\_type & ENUM & NOT NULL, Values: 'delivery', 'pickup', 'custom\_box' \\
\hline
delivery\_date & DATE & NULL, Scheduled or actual delivery date \\
\hline
delivery\_time\_slot & VARCHAR(50) & NULL, Delivery time window (e.g., "10:00-12:00") \\
\hline
special\_instructions & TEXT & NULL, Customer notes for order/delivery \\
\hline
promo\_code & VARCHAR(50) & NULL, Applied promotion code \\
\hline
icecoins\_used & INT & NOT NULL, DEFAULT 0, IceCoins redeemed for this order \\
\hline
icecoins\_earned & INT & NOT NULL, DEFAULT 0, IceCoins earned from this order \\
\hline
is\_gift & BOOLEAN & NOT NULL, DEFAULT FALSE, Gift order flag \\
\hline
estimated\_delivery\_at & TIMESTAMP & NULL, Estimated delivery timestamp \\
\hline
confirmed\_at & TIMESTAMP & NULL, Order confirmation timestamp \\
\hline
delivered\_at & TIMESTAMP & NULL, Actual delivery completion timestamp \\
\hline
cancelled\_at & TIMESTAMP & NULL, Order cancellation timestamp \\
\hline
cancellation\_reason & TEXT & NULL, Reason for cancellation \\
\hline
refund\_amount & DECIMAL(10, 2) & NULL, Refunded amount if applicable \\
\hline
refund\_reason & TEXT & NULL, Reason for refund \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
deleted\_at & TIMESTAMP & NULL, Soft delete timestamp \\
\hline
\caption{orders table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: users (user\_id), user\_addresses (delivery\_address\_id)
    \item One-to-Many: order\_items, payments, order\_status\_history
    \item One-to-One: deliveries
\end{itemize}

\newpage

\subsection{Table 13: order\_items}

\begin{tablebox}{order\_items - Order Line Items}
\textbf{Purpose:} Individual products/items within an order with pricing.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} order\_id, product\_id\\
\textbf{Indexes:} order\_id, product\_id
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
order\_id & BIGINT & FOREIGN KEY, NOT NULL, References orders(id) ON DELETE CASCADE \\
\hline
product\_id & BIGINT & FOREIGN KEY, NOT NULL, References products(id) \\
\hline
product\_name & VARCHAR(255) & NOT NULL, Snapshot of product name at order time \\
\hline
product\_sku & VARCHAR(100) & NOT NULL, Snapshot of SKU at order time \\
\hline
quantity & INT & NOT NULL, Quantity ordered \\
\hline
unit\_type & ENUM & NOT NULL, Values: 'piece', 'liter', 'box', 'scoop' \\
\hline
unit\_price & DECIMAL(10, 2) & NOT NULL, Price per unit at order time \\
\hline
subtotal & DECIMAL(10, 2) & NOT NULL, Quantity × unit price \\
\hline
discount\_amount & DECIMAL(10, 2) & NOT NULL, DEFAULT 0.00, Item-level discount \\
\hline
total & DECIMAL(10, 2) & NOT NULL, Final line item total after discount \\
\hline
notes & TEXT & NULL, Special requests for this item \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{order\_items table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: orders (order\_id), products (product\_id)
\end{itemize}

\textbf{Notes:}
\begin{itemize}
    \item Store product name/SKU snapshots for historical accuracy
    \item Prevents issues if product is renamed/deleted after order
    \item Support quantity-based discounts (bulk pricing)
\end{itemize}

\newpage

\subsection{Table 14: order\_status\_history}

\begin{tablebox}{order\_status\_history - Order Status Audit Trail}
\textbf{Purpose:} Complete history of order status transitions for tracking and analytics.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} order\_id\\
\textbf{Indexes:} order\_id, created\_at
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
order\_id & BIGINT & FOREIGN KEY, NOT NULL, References orders(id) ON DELETE CASCADE \\
\hline
from\_status & ENUM & NULL, Previous status (NULL for initial status) \\
\hline
to\_status & ENUM & NOT NULL, New status: 'pending', 'confirmed', 'preparing', 'ready', 'out\_for\_delivery', 'delivered', 'cancelled', 'refunded' \\
\hline
changed\_by\_type & ENUM & NOT NULL, Values: 'customer', 'admin', 'system', 'delivery\_personnel' \\
\hline
changed\_by\_id & BIGINT & NULL, User ID or admin ID who made the change \\
\hline
reason & TEXT & NULL, Reason for status change (especially for cancellations) \\
\hline
notes & TEXT & NULL, Additional notes about the status change \\
\hline
ip\_address & VARCHAR(45) & NULL, IP address of the actor \\
\hline
user\_agent & TEXT & NULL, User agent string \\
\hline
notification\_sent & BOOLEAN & NOT NULL, DEFAULT FALSE, Whether customer was notified \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
\caption{order\_status\_history table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: orders (order\_id)
\end{itemize}

\textbf{Use Cases:}
\begin{itemize}
    \item Audit trail for compliance and dispute resolution
    \item Analytics on order processing times per status
    \item Identify bottlenecks in order fulfillment
    \item Customer order tracking timeline display
    \item SLA monitoring (time between statuses)
\end{itemize}

\newpage

\subsection{Table 15: payments}

\begin{tablebox}{payments - Payment Transactions}
\textbf{Purpose:} Records all payment transactions with gateway responses and status.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} order\_id, user\_id\\
\textbf{Indexes:} order\_id, user\_id, transaction\_id (unique), status
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
order\_id & BIGINT & FOREIGN KEY, NOT NULL, References orders(id) \\
\hline
user\_id & BIGINT & FOREIGN KEY, NOT NULL, References users(id) \\
\hline
transaction\_id & VARCHAR(255) & UNIQUE, NOT NULL, Unique transaction identifier \\
\hline
payment\_method & ENUM & NOT NULL, Values: 'credit\_card', 'debit\_card', 'mobile\_wallet', 'bank\_transfer', 'cash\_on\_delivery', 'icecoins' \\
\hline
payment\_provider & VARCHAR(100) & NULL, Gateway provider: 'stripe', 'bkash', 'nagad', 'sslcommerz', etc. \\
\hline
amount & DECIMAL(10, 2) & NOT NULL, Payment amount \\
\hline
currency & VARCHAR(3) & NOT NULL, DEFAULT 'BDT', ISO 4217 currency code \\
\hline
status & ENUM & NOT NULL, DEFAULT 'pending', Values: 'pending', 'processing', 'success', 'failed', 'refunded', 'cancelled' \\
\hline
gateway\_transaction\_id & VARCHAR(255) & NULL, Payment gateway's transaction ID \\
\hline
gateway\_response & JSON & NULL, Full gateway response for debugging \\
\hline
error\_code & VARCHAR(50) & NULL, Error code if payment failed \\
\hline
error\_message & TEXT & NULL, Error message if payment failed \\
\hline
card\_last\_four & VARCHAR(4) & NULL, Last 4 digits of card (never store full number) \\
\hline
card\_brand & VARCHAR(50) & NULL, Card brand: 'visa', 'mastercard', 'amex' \\
\hline
billing\_name & VARCHAR(255) & NULL, Name on billing account \\
\hline
billing\_email & VARCHAR(255) & NULL, Billing email address \\
\hline
billing\_phone & VARCHAR(20) & NULL, Billing phone number \\
\hline
ip\_address & VARCHAR(45) & NULL, IP address of payment initiator \\
\hline
user\_agent & TEXT & NULL, User agent at payment time \\
\hline
refund\_amount & DECIMAL(10, 2) & NULL, Amount refunded if applicable \\
\hline
refund\_transaction\_id & VARCHAR(255) & NULL, Refund transaction ID from gateway \\
\hline
refunded\_at & TIMESTAMP & NULL, Refund completion timestamp \\
\hline
processed\_at & TIMESTAMP & NULL, Payment processing completion time \\
\hline
failed\_at & TIMESTAMP & NULL, Payment failure timestamp \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{payments table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: orders (order\_id), users (user\_id)
\end{itemize}

\textbf{Security Notes:}
\begin{itemize}
    \item NEVER store full credit card numbers (PCI-DSS compliance)
    \item Use tokenization for stored payment methods
    \item Encrypt sensitive fields at rest
    \item Log all payment attempts for fraud detection
    \item Implement rate limiting and fraud checks
\end{itemize}

\newpage

\subsection{Table 16: payment\_methods}

\begin{tablebox}{payment\_methods - Saved Payment Methods}
\textbf{Purpose:} Stores tokenized saved payment methods for quick checkout.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} user\_id\\
\textbf{Indexes:} user\_id, is\_default
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
user\_id & BIGINT & FOREIGN KEY, NOT NULL, References users(id) ON DELETE CASCADE \\
\hline
payment\_type & ENUM & NOT NULL, Values: 'credit\_card', 'debit\_card', 'mobile\_wallet', 'bank\_account' \\
\hline
provider & VARCHAR(100) & NOT NULL, Payment provider: 'stripe', 'bkash', 'nagad', etc. \\
\hline
token & VARCHAR(255) & NOT NULL, Tokenized payment method (from payment gateway) \\
\hline
label & VARCHAR(100) & NULL, User-friendly label: "My Visa Card", "Work Card" \\
\hline
card\_last\_four & VARCHAR(4) & NULL, Last 4 digits for display \\
\hline
card\_brand & VARCHAR(50) & NULL, Card brand: 'visa', 'mastercard', 'amex' \\
\hline
card\_expiry\_month & INT & NULL, Card expiration month (1-12) \\
\hline
card\_expiry\_year & INT & NULL, Card expiration year (4 digits) \\
\hline
cardholder\_name & VARCHAR(255) & NULL, Name on card \\
\hline
mobile\_wallet\_number & VARCHAR(20) & NULL, Mobile wallet phone number (masked) \\
\hline
bank\_name & VARCHAR(100) & NULL, Bank name for bank accounts \\
\hline
is\_default & BOOLEAN & NOT NULL, DEFAULT FALSE, Default payment method flag \\
\hline
is\_verified & BOOLEAN & NOT NULL, DEFAULT FALSE, Verification status \\
\hline
is\_active & BOOLEAN & NOT NULL, DEFAULT TRUE, Active status \\
\hline
last\_used\_at & TIMESTAMP & NULL, Last time this method was used \\
\hline
verified\_at & TIMESTAMP & NULL, Verification timestamp \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
deleted\_at & TIMESTAMP & NULL, Soft delete timestamp \\
\hline
\caption{payment\_methods table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: users (user\_id)
\end{itemize}

\textbf{Security \& Compliance:}
\begin{itemize}
    \item Store only tokenized payment data, never raw card numbers
    \item Tokens are obtained from payment gateway (Stripe, etc.)
    \item Implement PCI-DSS Level 1 compliance when handling cards
    \item Encrypt token field at application level
    \item Support CVV re-entry for enhanced security
\end{itemize}

\newpage

\section{Location \& Inventory Tables}

\subsection{Table 17: locations}

\begin{tablebox}{locations - Store/Depot/Freezer Locations}
\textbf{Purpose:} Physical locations where products are available (stores, depots, freezers).\\
\textbf{Primary Key:} id\\
\textbf{Indexes:} location\_type, is\_active, latitude/longitude (spatial)
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
location\_type & ENUM & NOT NULL, Values: 'store', 'depot', 'freezer', 'warehouse', 'kiosk' \\
\hline
name & VARCHAR(255) & NOT NULL, Location name (e.g., "Dhanmondi Outlet", "Gulshan Depot") \\
\hline
slug & VARCHAR(255) & UNIQUE, NOT NULL, URL-friendly identifier \\
\hline
code & VARCHAR(50) & UNIQUE, NULL, Internal location code \\
\hline
address\_line\_1 & VARCHAR(255) & NOT NULL, Street address \\
\hline
address\_line\_2 & VARCHAR(255) & NULL, Additional address details \\
\hline
city & VARCHAR(100) & NOT NULL, City name \\
\hline
district & VARCHAR(100) & NULL, District/region \\
\hline
postal\_code & VARCHAR(20) & NULL, Postal code \\
\hline
country & VARCHAR(100) & NOT NULL, DEFAULT 'Bangladesh', Country \\
\hline
latitude & DECIMAL(10, 8) & NOT NULL, GPS latitude for mapping and nearby search \\
\hline
longitude & DECIMAL(11, 8) & NOT NULL, GPS longitude for mapping and nearby search \\
\hline
phone & VARCHAR(20) & NULL, Location contact phone \\
\hline
email & VARCHAR(255) & NULL, Location contact email \\
\hline
operating\_hours & JSON & NULL, Daily operating hours: \{"monday": "09:00-21:00", ...\} \\
\hline
is\_24\_hours & BOOLEAN & NOT NULL, DEFAULT FALSE, 24/7 operation flag \\
\hline
facilities & JSON & NULL, Available facilities: ['parking', 'wifi', 'seating', 'drive\_thru'] \\
\hline
manager\_name & VARCHAR(255) & NULL, Location manager name \\
\hline
manager\_phone & VARCHAR(20) & NULL, Manager contact number \\
\hline
capacity & INT & NULL, Seating capacity or storage capacity \\
\hline
serves\_delivery & BOOLEAN & NOT NULL, DEFAULT TRUE, Supports delivery orders \\
\hline
serves\_pickup & BOOLEAN & NOT NULL, DEFAULT TRUE, Supports pickup orders \\
\hline
average\_rating & DECIMAL(3, 2) & NULL, DEFAULT 0.00, Location rating (0-5) \\
\hline
total\_reviews & INT & NOT NULL, DEFAULT 0, Review count \\
\hline
is\_active & BOOLEAN & NOT NULL, DEFAULT TRUE, Operational status \\
\hline
opening\_date & DATE & NULL, Location opening date \\
\hline
closing\_date & DATE & NULL, Permanent closure date if applicable \\
\hline
image\_url & VARCHAR(500) & NULL, Location photo URL \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
deleted\_at & TIMESTAMP & NULL, Soft delete timestamp \\
\hline
\caption{locations table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item One-to-Many: location\_inventory, location\_reviews, deliveries
\end{itemize}

\textbf{Spatial Queries:}
\begin{itemize}
    \item Implement spatial index on (latitude, longitude) for nearby location searches
    \item Use Haversine formula or MySQL spatial functions for distance calculations
    \item Support "Find nearest location" feature
\end{itemize}

\newpage

\subsection{Table 18: location\_inventory}

\begin{tablebox}{location\_inventory - Real-Time Stock Levels}
\textbf{Purpose:} Tracks inventory levels per product per location in real-time.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} location\_id, product\_id\\
\textbf{Indexes:} location\_id, product\_id, UNIQUE(location\_id, product\_id)
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
location\_id & BIGINT & FOREIGN KEY, NOT NULL, References locations(id) ON DELETE CASCADE \\
\hline
product\_id & BIGINT & FOREIGN KEY, NOT NULL, References products(id) ON DELETE CASCADE \\
\hline
quantity\_available & INT & NOT NULL, DEFAULT 0, Current stock quantity \\
\hline
quantity\_reserved & INT & NOT NULL, DEFAULT 0, Reserved for pending orders \\
\hline
minimum\_stock\_level & INT & NOT NULL, DEFAULT 0, Reorder threshold \\
\hline
maximum\_stock\_level & INT & NULL, Maximum storage capacity \\
\hline
reorder\_quantity & INT & NULL, Standard reorder amount \\
\hline
unit\_cost & DECIMAL(10, 2) & NULL, Cost per unit for inventory valuation \\
\hline
batch\_number & VARCHAR(100) & NULL, Current batch/lot number \\
\hline
expiry\_date & DATE & NULL, Product expiry date \\
\hline
last\_restock\_date & DATE & NULL, Last restocking date \\
\hline
last\_restock\_quantity & INT & NULL, Quantity in last restock \\
\hline
is\_low\_stock & BOOLEAN & NOT NULL, DEFAULT FALSE, Auto-calculated: quantity < minimum \\
\hline
is\_out\_of\_stock & BOOLEAN & NOT NULL, DEFAULT FALSE, Auto-calculated: quantity = 0 \\
\hline
last\_updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP, Track real-time updates \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{location\_inventory table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: locations (location\_id), products (product\_id)
\end{itemize}

\textbf{Inventory Management Features:}
\begin{itemize}
    \item Real-time stock availability for "Nearby Availability Finder"
    \item Automatic low-stock alerts when quantity < minimum\_stock\_level
    \item Reserved quantity prevents overselling pending orders
    \item Batch tracking for quality control and recalls
    \item Expiry date tracking for food safety compliance
    \item Integration with Stock Notification System
\end{itemize}

\textbf{Business Logic:}
\begin{itemize}
    \item \textbf{Available for Sale} = quantity\_available - quantity\_reserved
    \item Update quantity\_reserved when order placed, release on cancellation
    \item Decrement quantity\_available on order fulfillment
    \item Auto-trigger stock notifications when quantity goes from 0 to > 0
\end{itemize}

\newpage

\section{Delivery Tracking Tables}

\subsection{Table 19: delivery\_personnel}

\begin{tablebox}{delivery\_personnel - Delivery Driver Management}
\textbf{Purpose:} Information about delivery drivers and their current status.\\
\textbf{Primary Key:} id\\
\textbf{Indexes:} phone (unique), email (unique), status, is\_active
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
employee\_id & VARCHAR(50) & UNIQUE, NULL, Internal employee ID \\
\hline
full\_name & VARCHAR(255) & NOT NULL, Driver's full name \\
\hline
phone & VARCHAR(20) & UNIQUE, NOT NULL, Driver contact phone \\
\hline
email & VARCHAR(255) & UNIQUE, NULL, Driver email address \\
\hline
photo\_url & VARCHAR(500) & NULL, Driver photo for customer display \\
\hline
vehicle\_type & ENUM & NOT NULL, Values: 'bike', 'scooter', 'car', 'van', 'bicycle' \\
\hline
vehicle\_make & VARCHAR(100) & NULL, Vehicle manufacturer \\
\hline
vehicle\_model & VARCHAR(100) & NULL, Vehicle model \\
\hline
vehicle\_registration & VARCHAR(50) & NULL, Vehicle license plate number \\
\hline
vehicle\_color & VARCHAR(50) & NULL, Vehicle color for identification \\
\hline
license\_number & VARCHAR(100) & NULL, Driver's license number \\
\hline
license\_expiry\_date & DATE & NULL, License expiration date \\
\hline
current\_latitude & DECIMAL(10, 8) & NULL, Real-time GPS latitude \\
\hline
current\_longitude & DECIMAL(11, 8) & NULL, Real-time GPS longitude \\
\hline
location\_updated\_at & TIMESTAMP & NULL, Last GPS update timestamp \\
\hline
status & ENUM & NOT NULL, DEFAULT 'offline', Values: 'offline', 'online', 'busy', 'on\_delivery', 'break' \\
\hline
average\_rating & DECIMAL(3, 2) & NULL, DEFAULT 0.00, Driver rating (0-5) \\
\hline
total\_deliveries & INT & NOT NULL, DEFAULT 0, Lifetime delivery count \\
\hline
total\_reviews & INT & NOT NULL, DEFAULT 0, Review count \\
\hline
deliveries\_today & INT & NOT NULL, DEFAULT 0, Today's delivery count \\
\hline
is\_active & BOOLEAN & NOT NULL, DEFAULT TRUE, Active employment status \\
\hline
is\_verified & BOOLEAN & NOT NULL, DEFAULT FALSE, Background check status \\
\hline
hired\_date & DATE & NULL, Employment start date \\
\hline
termination\_date & DATE & NULL, Employment end date \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
deleted\_at & TIMESTAMP & NULL, Soft delete timestamp \\
\hline
\caption{delivery\_personnel table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item One-to-Many: deliveries
\end{itemize}

\textbf{Real-Time Tracking:}
\begin{itemize}
    \item GPS coordinates updated frequently during active deliveries
    \item Status changes tracked for availability management
    \item Integration with delivery assignment algorithms
    \item Performance metrics for driver management
\end{itemize}

\newpage

\subsection{Table 20: deliveries}

\begin{tablebox}{deliveries - Delivery Assignment \& Tracking}
\textbf{Purpose:} Links orders to delivery personnel with timing and tracking.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} order\_id, delivery\_personnel\_id, pickup\_location\_id\\
\textbf{Indexes:} order\_id (unique), delivery\_personnel\_id, status
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
order\_id & BIGINT & FOREIGN KEY, UNIQUE, NOT NULL, References orders(id) \\
\hline
delivery\_personnel\_id & BIGINT & FOREIGN KEY, NULL, References delivery\_personnel(id) \\
\hline
pickup\_location\_id & BIGINT & FOREIGN KEY, NULL, References locations(id) \\
\hline
delivery\_number & VARCHAR(50) & UNIQUE, NOT NULL, Tracking number (e.g., "DEL-20251109-0001") \\
\hline
status & ENUM & NOT NULL, DEFAULT 'pending', Values: 'pending', 'assigned', 'picked\_up', 'in\_transit', 'arrived', 'delivered', 'failed', 'returned' \\
\hline
scheduled\_pickup\_at & TIMESTAMP & NULL, Scheduled pickup time from location \\
\hline
actual\_pickup\_at & TIMESTAMP & NULL, Actual pickup timestamp \\
\hline
estimated\_delivery\_at & TIMESTAMP & NULL, Estimated delivery time \\
\hline
actual\_delivery\_at & TIMESTAMP & NULL, Actual delivery completion time \\
\hline
delivery\_attempts & INT & NOT NULL, DEFAULT 0, Number of delivery attempts \\
\hline
failed\_reason & TEXT & NULL, Reason for failed delivery \\
\hline
proof\_of\_delivery\_url & VARCHAR(500) & NULL, Photo/signature image URL \\
\hline
recipient\_name & VARCHAR(255) & NULL, Name of person who received delivery \\
\hline
recipient\_signature & TEXT & NULL, Digital signature data \\
\hline
distance\_km & DECIMAL(10, 2) & NULL, Total delivery distance in kilometers \\
\hline
delivery\_time\_minutes & INT & NULL, Actual delivery duration in minutes \\
\hline
customer\_rating & INT & NULL, Customer rating (1-5) for this delivery \\
\hline
customer\_feedback & TEXT & NULL, Customer delivery feedback \\
\hline
driver\_notes & TEXT & NULL, Driver's delivery notes \\
\hline
assigned\_at & TIMESTAMP & NULL, When delivery was assigned to driver \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{deliveries table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item One-to-One: orders (order\_id)
    \item Many-to-One: delivery\_personnel (delivery\_personnel\_id), locations (pickup\_location\_id)
    \item One-to-Many: delivery\_tracking\_events
\end{itemize}

\textbf{Delivery Lifecycle:}
\begin{enumerate}
    \item \textbf{pending} → Order placed, awaiting assignment
    \item \textbf{assigned} → Driver assigned to delivery
    \item \textbf{picked\_up} → Driver picked up order from location
    \item \textbf{in\_transit} → On the way to customer
    \item \textbf{arrived} → Driver arrived at delivery address
    \item \textbf{delivered} → Successfully delivered
    \item \textbf{failed} → Delivery failed (customer unavailable, wrong address, etc.)
    \item \textbf{returned} → Returned to location after failed delivery
\end{enumerate}

\newpage

\section{Summary}

\begin{tcolorbox}[colback=primaryBlue!10,colframe=primaryBlue,arc=3mm,boxrule=1mm]
\textbf{\large Part 2 Complete: Tables 11-20}

\vspace{0.3cm}

This document covers tables 11-20 of the SavoyConnect database schema:

\begin{itemize}
    \item \textbf{Product Catalog (1 table):} product\_images
    \item \textbf{Order Management (5 tables):} orders, order\_items, order\_status\_history, payments, payment\_methods
    \item \textbf{Location \& Inventory (2 tables):} locations, location\_inventory
    \item \textbf{Delivery Tracking (2 tables):} delivery\_personnel, deliveries
\end{itemize}

\vspace{0.3cm}

\textbf{Key Features Implemented:}
\begin{itemize}
    \item Complete order lifecycle management from cart to delivery
    \item Multi-payment method support with tokenization
    \item Real-time inventory tracking across locations
    \item GPS-based delivery tracking with status updates
    \item Comprehensive audit trails for orders and payments
    \item Support for nearby location discovery and availability
    \item Driver performance tracking and rating system
\end{itemize}

\vspace{0.3cm}

\textbf{Next Document:} Part 3 will cover tables 21-30 (Loyalty System, Challenges, Reviews, Referrals, Promotions)

\end{tcolorbox}

\end{document}
