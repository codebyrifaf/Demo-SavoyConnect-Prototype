\documentclass[11pt,a4paper]{article}

% Packages
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{xcolor}
\usepackage{titlesec}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{tcolorbox}
\usepackage{longtable}
\usepackage{array}
\usepackage{booktabs}
\usepackage{tikz}

% Page geometry
\geometry{
    left=2cm,
    right=2cm,
    top=2.5cm,
    bottom=2.5cm
}

% Color definitions
\definecolor{primaryBlue}{RGB}{0, 102, 204}
\definecolor{accentOrange}{RGB}{255, 127, 0}
\definecolor{darkGray}{RGB}{51, 51, 51}
\definecolor{lightGray}{RGB}{245, 245, 245}
\definecolor{tableHeader}{RGB}{25, 118, 210}

% Title formatting
\titleformat{\section}
  {\color{primaryBlue}\Large\bfseries}
  {\thesection}{1em}{}[\titlerule]

\titleformat{\subsection}
  {\color{accentOrange}\large\bfseries}
  {\thesubsection}{1em}{}

% Hyperref setup
\hypersetup{
    colorlinks=true,
    linkcolor=primaryBlue,
    filecolor=accentOrange,
    urlcolor=primaryBlue,
    pdftitle={SavoyConnect Database Tables - Part 3},
    pdfauthor={Rifaf Rahman}
}

% Header and footer
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\color{primaryBlue}\textbf{SavoyConnect Database - Part 3}}
\fancyhead[R]{\color{darkGray}\thepage}
\fancyfoot[C]{\color{darkGray}\small Tables 21-30 | Prepared by Rifaf Rahman | November 2025}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}

% Custom boxes
\newtcolorbox{tablebox}[1]{
  colback=lightGray,
  colframe=primaryBlue,
  fonttitle=\bfseries\large,
  title=#1,
  arc=2mm,
  boxrule=1mm
}

\begin{document}

% Title page
\begin{titlepage}
    \begin{tikzpicture}[remember picture,overlay]
        \fill[primaryBlue] (current page.north west) rectangle ([yshift=-8cm]current page.north east);
    \end{tikzpicture}
    
    \vspace*{2cm}
    
    {\color{white}\Huge\bfseries SavoyConnect}\\[0.5cm]
    {\color{white}\LARGE Database Schema - Part 3}\\[0.3cm]
    {\color{white}\Large Detailed Table Properties}\\[2cm]
    
    \vspace{3cm}
    
    \begin{tcolorbox}[colback=white,colframe=accentOrange,width=0.8\textwidth,arc=3mm,boxrule=1mm]
        \begin{tabular}{ll}
            \textbf{\color{primaryBlue}Prepared by:} & Rifaf Rahman \\[0.3cm]
            \textbf{\color{primaryBlue}Document:} & Part 3 of 8 \\[0.3cm]
            \textbf{\color{primaryBlue}Tables:} & 21-30 (Phase 2) \\[0.3cm]
            \textbf{\color{primaryBlue}Date:} & November 9, 2025 \\
        \end{tabular}
    \end{tcolorbox}
    
    \vfill
    
    {\large\color{darkGray} Loyalty \& Wallet, Challenges, Reviews, Referrals, Promotions}
    
\end{titlepage}

\tableofcontents
\newpage

\section{Loyalty \& Wallet System}

\subsection{Table 21: icecoins\_wallet}

\begin{tablebox}{icecoins\_wallet - User IceCoins Balance}
\textbf{Purpose:} Tracks each user's current IceCoins balance (loyalty points).\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} user\_id\\
\textbf{Indexes:} user\_id (unique)
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
user\_id & BIGINT & FOREIGN KEY, UNIQUE, NOT NULL, References users(id) ON DELETE CASCADE \\
\hline
balance & INT & NOT NULL, DEFAULT 0, Current IceCoins balance \\
\hline
lifetime\_earned & INT & NOT NULL, DEFAULT 0, Total IceCoins earned (all-time) \\
\hline
lifetime\_spent & INT & NOT NULL, DEFAULT 0, Total IceCoins spent (all-time) \\
\hline
pending\_balance & INT & NOT NULL, DEFAULT 0, IceCoins pending approval \\
\hline
expired\_total & INT & NOT NULL, DEFAULT 0, Total expired IceCoins \\
\hline
tier & ENUM & NOT NULL, DEFAULT 'bronze', Values: 'bronze', 'silver', 'gold', 'platinum', 'diamond' \\
\hline
tier\_progress & INT & NOT NULL, DEFAULT 0, Progress to next tier \\
\hline
tier\_threshold\_next & INT & NULL, IceCoins needed for next tier \\
\hline
tier\_achieved\_at & TIMESTAMP & NULL, When current tier was achieved \\
\hline
multiplier & DECIMAL(3, 2) & NOT NULL, DEFAULT 1.00, Earning multiplier based on tier \\
\hline
last\_earned\_at & TIMESTAMP & NULL, Last IceCoins earning timestamp \\
\hline
last\_spent\_at & TIMESTAMP & NULL, Last redemption timestamp \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{icecoins\_wallet table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item One-to-One: users (user\_id)
    \item One-to-Many: icecoins\_transactions
\end{itemize}

\textbf{Tier System:}
\begin{itemize}
    \item \textbf{Bronze:} 0-999 lifetime IceCoins, 1.0× multiplier
    \item \textbf{Silver:} 1,000-4,999 lifetime IceCoins, 1.2× multiplier
    \item \textbf{Gold:} 5,000-9,999 lifetime IceCoins, 1.5× multiplier
    \item \textbf{Platinum:} 10,000-24,999 lifetime IceCoins, 1.75× multiplier
    \item \textbf{Diamond:} 25,000+ lifetime IceCoins, 2.0× multiplier
\end{itemize}

\newpage

\subsection{Table 22: icecoins\_transactions}

\begin{tablebox}{icecoins\_transactions - IceCoins Transaction History}
\textbf{Purpose:} Complete audit trail of all IceCoins earnings and redemptions.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} user\_id, order\_id, challenge\_id\\
\textbf{Indexes:} user\_id, transaction\_type, created\_at
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
user\_id & BIGINT & FOREIGN KEY, NOT NULL, References users(id) ON DELETE CASCADE \\
\hline
transaction\_type & ENUM & NOT NULL, Values: 'earned', 'spent', 'refunded', 'expired', 'adjusted', 'bonus' \\
\hline
amount & INT & NOT NULL, IceCoins amount (positive for earn, negative for spend) \\
\hline
balance\_before & INT & NOT NULL, Balance before transaction \\
\hline
balance\_after & INT & NOT NULL, Balance after transaction \\
\hline
source\_type & ENUM & NOT NULL, Values: 'order', 'challenge', 'referral', 'review', 'signup\_bonus', 'admin', 'promotion', 'expiry' \\
\hline
source\_id & BIGINT & NULL, ID of related entity (order\_id, challenge\_id, etc.) \\
\hline
order\_id & BIGINT & FOREIGN KEY, NULL, References orders(id) if order-related \\
\hline
challenge\_id & BIGINT & FOREIGN KEY, NULL, References challenges(id) if challenge-related \\
\hline
description & VARCHAR(500) & NOT NULL, Transaction description for user \\
\hline
multiplier\_applied & DECIMAL(3, 2) & NULL, Tier multiplier at transaction time \\
\hline
base\_amount & INT & NULL, Original amount before multiplier \\
\hline
expiry\_date & DATE & NULL, When these IceCoins expire (for earned coins) \\
\hline
is\_expired & BOOLEAN & NOT NULL, DEFAULT FALSE, Expiry status \\
\hline
expired\_at & TIMESTAMP & NULL, Expiration timestamp \\
\hline
admin\_user\_id & BIGINT & NULL, Admin who made adjustment (for manual transactions) \\
\hline
admin\_notes & TEXT & NULL, Admin notes for manual adjustments \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
\caption{icecoins\_transactions table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: users (user\_id), orders (order\_id), challenges (challenge\_id)
\end{itemize}

\textbf{Transaction Examples:}
\begin{itemize}
    \item \textbf{Earned:} "+50 IceCoins from order \#ORD-123"
    \item \textbf{Spent:} "-100 IceCoins applied to order \#ORD-456"
    \item \textbf{Refunded:} "+100 IceCoins refunded from cancelled order"
    \item \textbf{Expired:} "-25 IceCoins expired (earned 12 months ago)"
    \item \textbf{Bonus:} "+500 IceCoins signup bonus"
\end{itemize}

\newpage

\subsection{Table 23: loyalty\_tiers}

\begin{tablebox}{loyalty\_tiers - Tier Configuration}
\textbf{Purpose:} Defines loyalty tier thresholds, benefits, and multipliers.\\
\textbf{Primary Key:} id\\
\textbf{Indexes:} tier\_name (unique), min\_points
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
tier\_name & VARCHAR(50) & UNIQUE, NOT NULL, Tier name: 'bronze', 'silver', 'gold', 'platinum', 'diamond' \\
\hline
tier\_level & INT & UNIQUE, NOT NULL, Numeric level (1=bronze, 5=diamond) \\
\hline
min\_points & INT & NOT NULL, Minimum lifetime IceCoins required \\
\hline
max\_points & INT & NULL, Maximum points (NULL for highest tier) \\
\hline
multiplier & DECIMAL(3, 2) & NOT NULL, DEFAULT 1.00, Earning multiplier \\
\hline
color\_hex & VARCHAR(7) & NOT NULL, Tier color for UI display \\
\hline
icon\_url & VARCHAR(500) & NULL, Tier badge icon URL \\
\hline
benefits & JSON & NULL, Array of benefits: ["Free delivery", "Priority support", "Exclusive products"] \\
\hline
discount\_percentage & DECIMAL(5, 2) & NOT NULL, DEFAULT 0.00, Tier-specific discount (0-100) \\
\hline
birthday\_bonus & INT & NOT NULL, DEFAULT 0, Extra IceCoins on birthday \\
\hline
free\_delivery\_threshold & DECIMAL(10, 2) & NULL, Minimum order for free delivery \\
\hline
priority\_support & BOOLEAN & NOT NULL, DEFAULT FALSE, Access to priority customer support \\
\hline
early\_access & BOOLEAN & NOT NULL, DEFAULT FALSE, Early access to new products \\
\hline
exclusive\_products & BOOLEAN & NOT NULL, DEFAULT FALSE, Access to tier-exclusive products \\
\hline
is\_active & BOOLEAN & NOT NULL, DEFAULT TRUE, Tier active status \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{loyalty\_tiers table structure}
\end{longtable}

\textbf{Example Configuration:}
\begin{itemize}
    \item \textbf{Bronze:} 0-999 points, 1.0× multiplier, \#CD7F32 color
    \item \textbf{Silver:} 1,000-4,999 points, 1.2× multiplier, \#C0C0C0 color, birthday bonus 50
    \item \textbf{Gold:} 5,000-9,999 points, 1.5× multiplier, \#FFD700 color, priority support
    \item \textbf{Platinum:} 10,000-24,999 points, 1.75× multiplier, \#E5E4E2 color, early access
    \item \textbf{Diamond:} 25,000+ points, 2.0× multiplier, \#B9F2FF color, all benefits
\end{itemize}

\newpage

\subsection{Table 24: reward\_redemptions}

\begin{tablebox}{reward\_redemptions - Reward Catalog Redemptions}
\textbf{Purpose:} Tracks redemption of special rewards/prizes with IceCoins.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} user\_id, reward\_id\\
\textbf{Indexes:} user\_id, reward\_id, status
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
user\_id & BIGINT & FOREIGN KEY, NOT NULL, References users(id) ON DELETE CASCADE \\
\hline
reward\_id & BIGINT & FOREIGN KEY, NOT NULL, References rewards\_catalog(id) \\
\hline
redemption\_code & VARCHAR(50) & UNIQUE, NOT NULL, Unique code for verification \\
\hline
icecoins\_cost & INT & NOT NULL, IceCoins spent on redemption \\
\hline
reward\_name & VARCHAR(255) & NOT NULL, Snapshot of reward name \\
\hline
reward\_description & TEXT & NULL, Snapshot of reward description \\
\hline
reward\_type & ENUM & NOT NULL, Values: 'discount\_coupon', 'free\_product', 'merchandise', 'gift\_card', 'experience' \\
\hline
status & ENUM & NOT NULL, DEFAULT 'pending', Values: 'pending', 'approved', 'shipped', 'delivered', 'used', 'expired', 'cancelled' \\
\hline
approval\_required & BOOLEAN & NOT NULL, DEFAULT FALSE, Requires admin approval \\
\hline
approved\_by & BIGINT & NULL, Admin ID who approved \\
\hline
approved\_at & TIMESTAMP & NULL, Approval timestamp \\
\hline
shipping\_address\_id & BIGINT & NULL, References user\_addresses(id) for physical rewards \\
\hline
tracking\_number & VARCHAR(100) & NULL, Shipment tracking number \\
\hline
expiry\_date & DATE & NULL, Redemption expiration date \\
\hline
is\_used & BOOLEAN & NOT NULL, DEFAULT FALSE, Usage status \\
\hline
used\_at & TIMESTAMP & NULL, When reward was used \\
\hline
notes & TEXT & NULL, Admin or system notes \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{reward\_redemptions table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: users (user\_id), rewards\_catalog (reward\_id), user\_addresses (shipping\_address\_id)
\end{itemize}

\textbf{Reward Types:}
\begin{itemize}
    \item \textbf{discount\_coupon:} Promo code for percentage/amount off
    \item \textbf{free\_product:} Free product voucher
    \item \textbf{merchandise:} Branded merchandise (t-shirts, bags, etc.)
    \item \textbf{gift\_card:} External gift cards
    \item \textbf{experience:} Special experiences (cooking classes, tours)
\end{itemize}

\newpage

\section{Challenges \& Gamification}

\subsection{Table 25: challenges}

\begin{tablebox}{challenges - Gamification Challenges}
\textbf{Purpose:} Defines available challenges users can complete for rewards.\\
\textbf{Primary Key:} id\\
\textbf{Indexes:} challenge\_type, status, start\_date, end\_date
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
title & VARCHAR(255) & NOT NULL, Challenge title: "First Order Challenge", "Recipe Master" \\
\hline
description & TEXT & NOT NULL, Detailed challenge description \\
\hline
challenge\_type & ENUM & NOT NULL, Values: 'one\_time', 'recurring\_daily', 'recurring\_weekly', 'recurring\_monthly', 'seasonal' \\
\hline
category & ENUM & NOT NULL, Values: 'ordering', 'recipes', 'social', 'review', 'referral', 'streak', 'exploration' \\
\hline
difficulty & ENUM & NOT NULL, DEFAULT 'easy', Values: 'easy', 'medium', 'hard', 'expert' \\
\hline
target\_metric & VARCHAR(100) & NOT NULL, Metric to track: 'order\_count', 'recipe\_tries', 'days\_streak', etc. \\
\hline
target\_value & INT & NOT NULL, Goal value to achieve \\
\hline
current\_progress\_formula & TEXT & NULL, SQL or logic to calculate progress \\
\hline
reward\_icecoins & INT & NOT NULL, DEFAULT 0, IceCoins reward for completion \\
\hline
reward\_badge\_id & BIGINT & NULL, Badge ID awarded \\
\hline
reward\_additional & JSON & NULL, Additional rewards: \{"free\_delivery": true, "discount\_code": "CHAL50"\} \\
\hline
icon\_url & VARCHAR(500) & NULL, Challenge icon image \\
\hline
banner\_image\_url & VARCHAR(500) & NULL, Challenge banner/card image \\
\hline
tier\_requirement & ENUM & NULL, Minimum tier: 'bronze', 'silver', 'gold', 'platinum', 'diamond' \\
\hline
max\_completions & INT & NULL, Max times challenge can be completed (NULL for unlimited) \\
\hline
is\_active & BOOLEAN & NOT NULL, DEFAULT TRUE, Challenge active status \\
\hline
is\_featured & BOOLEAN & NOT NULL, DEFAULT FALSE, Featured on homepage \\
\hline
start\_date & DATE & NULL, Challenge start date (NULL for always available) \\
\hline
end\_date & DATE & NULL, Challenge end date (NULL for no expiry) \\
\hline
participant\_count & INT & NOT NULL, DEFAULT 0, Users currently participating \\
\hline
completion\_count & INT & NOT NULL, DEFAULT 0, Total completions \\
\hline
sort\_order & INT & NOT NULL, DEFAULT 0, Display order \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{challenges table structure}
\end{longtable}

\textbf{Challenge Examples:}
\begin{itemize}
    \item \textbf{First Order:} Place 1 order → 100 IceCoins
    \item \textbf{Recipe Explorer:} Try 5 different recipes → 200 IceCoins + "Chef" badge
    \item \textbf{Week Warrior:} Order 7 days in a row → 500 IceCoins
    \item \textbf{Social Butterfly:} Share 10 recipes → 150 IceCoins
    \item \textbf{Review Master:} Write 20 reviews → 300 IceCoins
\end{itemize}

\newpage

\subsection{Table 26: user\_challenges}

\begin{tablebox}{user\_challenges - User Challenge Progress}
\textbf{Purpose:} Tracks individual user progress on active challenges.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} user\_id, challenge\_id\\
\textbf{Indexes:} user\_id, challenge\_id, status, UNIQUE(user\_id, challenge\_id, started\_at)
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
user\_id & BIGINT & FOREIGN KEY, NOT NULL, References users(id) ON DELETE CASCADE \\
\hline
challenge\_id & BIGINT & FOREIGN KEY, NOT NULL, References challenges(id) ON DELETE CASCADE \\
\hline
status & ENUM & NOT NULL, DEFAULT 'in\_progress', Values: 'in\_progress', 'completed', 'failed', 'expired', 'abandoned' \\
\hline
current\_progress & INT & NOT NULL, DEFAULT 0, Current progress value \\
\hline
target\_value & INT & NOT NULL, Goal value (snapshot from challenge) \\
\hline
progress\_percentage & DECIMAL(5, 2) & NOT NULL, DEFAULT 0.00, Calculated progress \% (0-100) \\
\hline
completion\_count & INT & NOT NULL, DEFAULT 0, How many times user completed this challenge \\
\hline
last\_progress\_at & TIMESTAMP & NULL, Last time progress was updated \\
\hline
started\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP, Challenge start time \\
\hline
completed\_at & TIMESTAMP & NULL, Completion timestamp \\
\hline
expires\_at & TIMESTAMP & NULL, Challenge expiration time \\
\hline
reward\_claimed & BOOLEAN & NOT NULL, DEFAULT FALSE, Reward claim status \\
\hline
reward\_claimed\_at & TIMESTAMP & NULL, When reward was claimed \\
\hline
icecoins\_earned & INT & NOT NULL, DEFAULT 0, IceCoins earned from this challenge \\
\hline
notification\_sent & BOOLEAN & NOT NULL, DEFAULT FALSE, Completion notification sent \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{user\_challenges table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: users (user\_id), challenges (challenge\_id)
\end{itemize}

\textbf{Progress Tracking Logic:}
\begin{itemize}
    \item Auto-update current\_progress on relevant user actions
    \item Calculate progress\_percentage = (current\_progress / target\_value) × 100
    \item Mark as completed when current\_progress ≥ target\_value
    \item Send notification when status changes to completed
    \item Allow recurring challenges (new record created after completion)
\end{itemize}

\newpage

\subsection{Table 27: challenge\_progress\_events}

\begin{tablebox}{challenge\_progress\_events - Challenge Activity Log}
\textbf{Purpose:} Detailed log of all actions contributing to challenge progress.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} user\_challenge\_id\\
\textbf{Indexes:} user\_challenge\_id, created\_at
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
user\_challenge\_id & BIGINT & FOREIGN KEY, NOT NULL, References user\_challenges(id) ON DELETE CASCADE \\
\hline
event\_type & VARCHAR(100) & NOT NULL, Type of action: 'order\_placed', 'recipe\_tried', 'review\_posted', etc. \\
\hline
related\_entity\_type & VARCHAR(50) & NULL, Entity type: 'order', 'recipe', 'review', 'referral' \\
\hline
related\_entity\_id & BIGINT & NULL, ID of related entity \\
\hline
progress\_increment & INT & NOT NULL, DEFAULT 1, How much progress this event adds \\
\hline
progress\_before & INT & NOT NULL, Progress value before this event \\
\hline
progress\_after & INT & NOT NULL, Progress value after this event \\
\hline
description & VARCHAR(500) & NULL, Event description for display \\
\hline
metadata & JSON & NULL, Additional event metadata \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
\caption{challenge\_progress\_events table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: user\_challenges (user\_challenge\_id)
\end{itemize}

\textbf{Example Events:}
\begin{itemize}
    \item Order placed: +1 progress toward "10 Orders Challenge"
    \item Recipe tried: +1 progress toward "Recipe Explorer Challenge"
    \item Daily login: +1 progress toward "7-Day Streak Challenge"
    \item Review posted: +1 progress toward "Review Master Challenge"
\end{itemize}

\newpage

\section{Reviews \& Ratings}

\subsection{Table 28: reviews}

\begin{tablebox}{reviews - Product \& Location Reviews}
\textbf{Purpose:} User reviews and ratings for products, locations, and orders.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} user\_id, product\_id, location\_id, order\_id\\
\textbf{Indexes:} user\_id, product\_id, location\_id, order\_id, is\_verified, status
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
user\_id & BIGINT & FOREIGN KEY, NOT NULL, References users(id) ON DELETE CASCADE \\
\hline
reviewable\_type & ENUM & NOT NULL, Values: 'product', 'location', 'order', 'recipe' \\
\hline
reviewable\_id & BIGINT & NOT NULL, ID of the reviewed entity \\
\hline
product\_id & BIGINT & FOREIGN KEY, NULL, References products(id) if product review \\
\hline
location\_id & BIGINT & FOREIGN KEY, NULL, References locations(id) if location review \\
\hline
order\_id & BIGINT & FOREIGN KEY, NULL, References orders(id) for verified purchases \\
\hline
rating & INT & NOT NULL, Rating value 1-5 stars \\
\hline
title & VARCHAR(255) & NULL, Review title/headline \\
\hline
comment & TEXT & NOT NULL, Review text content \\
\hline
pros & TEXT & NULL, Positive aspects \\
\hline
cons & TEXT & NULL, Negative aspects \\
\hline
is\_verified\_purchase & BOOLEAN & NOT NULL, DEFAULT FALSE, Verified buyer badge \\
\hline
is\_featured & BOOLEAN & NOT NULL, DEFAULT FALSE, Featured review flag \\
\hline
helpful\_count & INT & NOT NULL, DEFAULT 0, Number of "helpful" votes \\
\hline
not\_helpful\_count & INT & NOT NULL, DEFAULT 0, Number of "not helpful" votes \\
\hline
status & ENUM & NOT NULL, DEFAULT 'pending', Values: 'pending', 'approved', 'rejected', 'reported', 'removed' \\
\hline
moderation\_notes & TEXT & NULL, Admin moderation notes \\
\hline
moderated\_by & BIGINT & NULL, Admin ID who moderated \\
\hline
moderated\_at & TIMESTAMP & NULL, Moderation timestamp \\
\hline
icecoins\_awarded & INT & NOT NULL, DEFAULT 0, IceCoins earned for this review \\
\hline
images & JSON & NULL, Array of review image URLs \\
\hline
reported\_count & INT & NOT NULL, DEFAULT 0, Times reported by users \\
\hline
flagged\_for\_review & BOOLEAN & NOT NULL, DEFAULT FALSE, Flagged for moderation \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
deleted\_at & TIMESTAMP & NULL, Soft delete timestamp \\
\hline
\caption{reviews table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: users (user\_id), products (product\_id), locations (location\_id), orders (order\_id)
    \item One-to-Many: review\_responses, review\_votes
\end{itemize}

\textbf{Review Workflow:}
\begin{enumerate}
    \item User submits review (status: pending)
    \item Auto-approve if user has verified purchases OR manual moderation
    \item Approved reviews visible to public
    \item Award IceCoins for first review (e.g., 50 coins)
    \item Users can vote helpful/not helpful
    \item Featured reviews displayed prominently
\end{enumerate}

\newpage

\subsection{Table 29: review\_responses}

\begin{tablebox}{review\_responses - Admin/Vendor Responses to Reviews}
\textbf{Purpose:} Official responses to customer reviews from business.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} review\_id, responder\_id\\
\textbf{Indexes:} review\_id, responder\_id
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
review\_id & BIGINT & FOREIGN KEY, NOT NULL, References reviews(id) ON DELETE CASCADE \\
\hline
responder\_id & BIGINT & FOREIGN KEY, NOT NULL, Admin/vendor user ID \\
\hline
responder\_name & VARCHAR(255) & NOT NULL, Name displayed (e.g., "SavoyConnect Team") \\
\hline
responder\_role & VARCHAR(100) & NULL, Role/title (e.g., "Customer Support Manager") \\
\hline
response\_text & TEXT & NOT NULL, Response content \\
\hline
is\_official & BOOLEAN & NOT NULL, DEFAULT TRUE, Official company response flag \\
\hline
is\_visible & BOOLEAN & NOT NULL, DEFAULT TRUE, Visibility status \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{review\_responses table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: reviews (review\_id)
\end{itemize}

\textbf{Response Best Practices:}
\begin{itemize}
    \item Thank customer for feedback
    \item Address specific concerns mentioned in review
    \item Offer solutions or compensation if applicable
    \item Professional and friendly tone
    \item Respond within 24-48 hours of review
    \item Public responses show customer care commitment
\end{itemize}

\newpage

\subsection{Table 30: review\_votes}

\begin{tablebox}{review\_votes - Review Helpfulness Voting}
\textbf{Purpose:} Tracks user votes on review helpfulness.\\
\textbf{Primary Key:} id\\
\textbf{Foreign Keys:} review\_id, user\_id\\
\textbf{Indexes:} review\_id, user\_id, UNIQUE(review\_id, user\_id)
\end{tablebox}

\begin{longtable}{|p{3.5cm}|p{2.5cm}|p{6cm}|}
\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endfirsthead

\hline
\rowcolor{tableHeader}
\textcolor{white}{\textbf{Column Name}} & \textcolor{white}{\textbf{Data Type}} & \textcolor{white}{\textbf{Constraints \& Description}} \\
\hline
\endhead

id & BIGINT & PRIMARY KEY, AUTO\_INCREMENT \\
\hline
review\_id & BIGINT & FOREIGN KEY, NOT NULL, References reviews(id) ON DELETE CASCADE \\
\hline
user\_id & BIGINT & FOREIGN KEY, NOT NULL, References users(id) ON DELETE CASCADE \\
\hline
vote\_type & ENUM & NOT NULL, Values: 'helpful', 'not\_helpful' \\
\hline
created\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP \\
\hline
updated\_at & TIMESTAMP & NOT NULL, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP \\
\hline
\caption{review\_votes table structure}
\end{longtable}

\textbf{Relationships:}
\begin{itemize}
    \item Many-to-One: reviews (review\_id), users (user\_id)
\end{itemize}

\textbf{Voting Logic:}
\begin{itemize}
    \item Each user can vote once per review (enforced by unique constraint)
    \item Users can change vote (update existing record)
    \item Helpful count increments review.helpful\_count
    \item Sort reviews by helpfulness ratio: helpful / (helpful + not\_helpful)
    \item Most helpful reviews appear first
    \item Voting helps surface quality reviews
\end{itemize}

\newpage

\section{Summary}

\begin{tcolorbox}[colback=primaryBlue!10,colframe=primaryBlue,arc=3mm,boxrule=1mm]
\textbf{\large Part 3 Complete: Tables 21-30}

\vspace{0.3cm}

This document covers tables 21-30 of the SavoyConnect database schema:

\begin{itemize}
    \item \textbf{Loyalty \& Wallet (4 tables):} icecoins\_wallet, icecoins\_transactions, loyalty\_tiers, reward\_redemptions
    \item \textbf{Challenges (3 tables):} challenges, user\_challenges, challenge\_progress\_events
    \item \textbf{Reviews \& Ratings (3 tables):} reviews, review\_responses, review\_votes
\end{itemize}

\vspace{0.3cm}

\textbf{Key Features Implemented:}
\begin{itemize}
    \item Complete IceCoins loyalty system with tier progression
    \item Multi-tier loyalty program (Bronze to Diamond) with multipliers
    \item Flexible challenge system for gamification and engagement
    \item Progress tracking with real-time updates and notifications
    \item Comprehensive review system with verification and moderation
    \item Review helpfulness voting and official response capabilities
    \item Reward redemption catalog with various reward types
    \item Transaction audit trail for all IceCoins movements
\end{itemize}

\vspace{0.3cm}

\textbf{Next Document:} Part 4 will cover tables 31-40 (Referrals, Promotions, Notifications, Recipes, Content)

\end{tcolorbox}

\end{document}
